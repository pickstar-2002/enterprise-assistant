# ä¼ä¸šçº§ AI æ•°å­—å‘˜å·¥ - å¼€å‘æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| é¡¹ç›®åç§° | ä¼ä¸šçº§ AI æ•°å­—å‘˜å·¥ - HR/IT æ™ºèƒ½åŠ©æ‰‹ |
| èµ›é“ | ä¼ä¸šçº§ AI æ•°å­—å‘˜å·¥èµ›é“ |
| æ–¹å‘ | HR / IT åŠ©æ‰‹ï¼šè‡ªåŠ¨è§£ç­”æ”¿ç­–ç–‘é—®ä¸æ•…éšœæŠ¥ä¿® |
| æ–‡æ¡£ç‰ˆæœ¬ | v2.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-31 |
| æœ€åæ›´æ–° | 2025-12-31 |

---

## ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
5. [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
6. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
7. [è‡ªå®šä¹‰çŸ¥è¯†åº“](#è‡ªå®šä¹‰çŸ¥è¯†åº“)
8. [å¤šæ¨¡æ€å¯¹è¯](#å¤šæ¨¡æ€å¯¹è¯)
9. [ç•Œé¢è®¾è®¡](#ç•Œé¢è®¾è®¡)
10. [æ•°æ®æŒä¹…åŒ–](#æ•°æ®æŒä¹…åŒ–)
11. [å·¥å•ç³»ç»Ÿç»†èŠ‚](#å·¥å•ç³»ç»Ÿç»†èŠ‚)
12. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
13. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
14. [æµ‹è¯•ä¸éƒ¨ç½²](#æµ‹è¯•ä¸éƒ¨ç½²)
15. [å¯†é’¥ç®¡ç†](#å¯†é’¥ç®¡ç†)
16. [å¼€å‘è®¡åˆ’](#å¼€å‘è®¡åˆ’)

---

## é¡¹ç›®ç®€ä»‹

### é¡¹ç›®æè¿°

åŸºäºé­”çæ˜Ÿäº‘3Dæ•°å­—äººæŠ€æœ¯ï¼Œæ‰“é€ ä¸€ä¸ªé¢å‘ä¼ä¸šåœºæ™¯çš„æ™ºèƒ½æ•°å­—å‘˜å·¥ï¼Œä¸“æ³¨äº HR æ”¿ç­–è§£ç­”å’Œ IT æ•…éšœæŠ¥ä¿®ä¸¤å¤§æ ¸å¿ƒåœºæ™¯ï¼Œä¸ºä¼ä¸šå‘˜å·¥æä¾› 7Ã—24 å°æ—¶çš„æ™ºèƒ½å’¨è¯¢æœåŠ¡ã€‚

**æ ¸å¿ƒç‰¹è‰²**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ä¸Šä¼ ä¼ä¸šçŸ¥è¯†åº“ï¼Œè‡ªåŠ¨å‘é‡åŒ–å’Œæ£€ç´¢ï¼Œè®©æ¯ä¸ªä¼ä¸šéƒ½èƒ½æ‹¥æœ‰ä¸“å±çš„æ•°å­—å‘˜å·¥ã€‚

### æ ¸å¿ƒåŠŸèƒ½

| æ¨¡å— | åŠŸèƒ½æè¿° |
|------|----------|
| **å¯†é’¥ç®¡ç†** | é¦–æ¬¡è®¿é—®å¼•å¯¼é…ç½®å¯†é’¥ï¼Œæ”¯æŒå†…ç½®æµ‹è¯•å¯†é’¥å¿«é€Ÿä½“éªŒ |
| **è¿æ¥æ§åˆ¶** | æ‰‹åŠ¨æ§åˆ¶æ•°å­—äººè¿æ¥/æ–­å¼€ï¼Œé¿å…ç§¯åˆ†æµªè´¹ |
| **è‡ªå®šä¹‰çŸ¥è¯†åº“** | ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ï¼Œè‡ªåŠ¨æå–æ–‡æœ¬ã€åˆ†å—ã€å‘é‡åŒ–å­˜å‚¨ |
| **HR æ”¿ç­–è§£ç­”** | è–ªèµ„ç¦åˆ©ã€è€ƒå‹¤ä¼‘å‡ã€æ‹›è˜å…¥èŒã€åŸ¹è®­å‘å±•ç­‰æ”¿ç­–å’¨è¯¢ |
| **IT æ•…éšœæŠ¥ä¿®** | ç¡¬ä»¶æ•…éšœã€è½¯ä»¶é—®é¢˜ã€ç½‘ç»œé—®é¢˜ã€è´¦å·æƒé™ç­‰æŠ€æœ¯æ”¯æŒ |
| **å¿«æ·æé—®** | é¢„è®¾å¸¸è§é—®é¢˜ï¼Œä¸€é”®å¿«é€Ÿå’¨è¯¢ |
| **å·¥å•åˆ›å»º** | è‡ªåŠ¨ç”Ÿæˆæ•…éšœå·¥å•ï¼Œæ”¯æŒå·¥å•çŠ¶æ€è·Ÿè¸ª |
| **æ•°å­—äººé©±åŠ¨** | é­”çæ˜Ÿäº‘3Dæ•°å­—äººï¼Œè¯­éŸ³æ’­æŠ¥+è¡¨æƒ…åŒæ­¥ |
| **çŸ¥è¯†åº“å¼•ç”¨** | æ˜¾ç¤ºå›å¤å‚è€ƒçš„ä¼ä¸šçŸ¥è¯†åº“æ¥æº |

### æŠ€æœ¯äº®ç‚¹

- é­”çæ˜Ÿäº‘3Dæ•°å­—äººï¼ˆä¸“ä¸šçš„ä¼ä¸šå½¢è±¡ï¼‰
- é­”æ­ç¤¾åŒº Qwen3-VLï¼ˆæ”¯æŒå¤šæ¨¡æ€ï¼Œå¯ç†è§£å›¾ç‰‡ï¼‰
- é­”æ­ç¤¾åŒº Qwen3-Embedding-8Bï¼ˆé«˜æ€§èƒ½å‘é‡åŒ–ï¼‰
- è‡ªå®šä¹‰çŸ¥è¯†åº“ä¸Šä¼ ï¼ˆæ”¯æŒ txt/md/pdf/docx ç­‰æ ¼å¼ï¼‰
- RAG ä¼ä¸šçŸ¥è¯†åº“ï¼ˆè‡ªåŠ¨åˆ†å—ã€å‘é‡åŒ–ã€æ£€ç´¢ï¼‰
- å·¥å•ç³»ç»Ÿï¼ˆè‡ªåŠ¨åˆ›å»ºå’Œè·Ÿè¸ªï¼‰
- æµå¼å¯¹è¯å“åº”ï¼ˆå®æ—¶åé¦ˆï¼‰

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ

```yaml
æ¡†æ¶: React 18.x + TypeScript
æ„å»ºå·¥å…·: Vite 5.x
çŠ¶æ€ç®¡ç†: Zustand
æ ·å¼æ–¹æ¡ˆ: TailwindCSS
HTTPå®¢æˆ·ç«¯: Fetch API
æ–‡ä»¶å¤„ç†: pdf-parse, mammoth (for docx)
å‘é‡å­˜å‚¨: å†…å­˜å­˜å‚¨ + localStorage æŒä¹…åŒ–
```

### åç«¯æŠ€æœ¯æ ˆ

```yaml
è¿è¡Œç¯å¢ƒ: Node.js 18.x
æ¡†æ¶: Express + TypeScript
AIæœåŠ¡: é­”æ­ç¤¾åŒº (ModelScope)
å¯¹è¯æ¨¡å‹: Qwen/Qwen3-VL-235B-A22B-Instruct (æ”¯æŒå¤šæ¨¡æ€)
åµŒå…¥æ¨¡å‹: Qwen/Qwen3-Embedding-8B
å‘é‡æ£€ç´¢: ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
æ–‡ä»¶å¤„ç†: pdf-parse, mammoth, txt-reader
å…¶ä»–: cors, dotenv, uuid, multer
```

### å…·èº«é©±åŠ¨SDK

```yaml
SDKåç§°: é­”çæ˜Ÿäº‘å…·èº«é©±åŠ¨SDK
ç‰ˆæœ¬: 0.1.0-alpha.72 (æœ€æ–°ç‰ˆæœ¬)
æ¥å…¥æ–¹å¼: JavaScript CDN
CDNåœ°å€: https://media.xingyun3d.com/xingyun3d/general/litesdk/xmovAvatar@latest.js
```

### AI æ¨¡å‹é…ç½®

```javascript
// åµŒå…¥æ¨¡å‹ - ç”¨äºæ–‡æœ¬å‘é‡åŒ–
const embeddingClient = new OpenAI({
  baseURL: 'https://api-inference.modelscope.cn/v1',
  apiKey: 'ms-de3c153b-5a19-41d1-bd3e-257a7eef7922'
});

const embeddingResponse = await embeddingClient.embeddings.create({
  model: 'Qwen/Qwen3-Embedding-8B',
  input: text,
  encoding_format: 'float'
});

// å¯¹è¯æ¨¡å‹ - æ”¯æŒå¤šæ¨¡æ€ï¼ˆæ–‡æœ¬+å›¾ç‰‡ï¼‰
const chatClient = new OpenAI({
  baseURL: 'https://api-inference.modelscope.cn/v1',
  apiKey: 'ms-de3c153b-5a19-41d1-bd3e-257a7eef7922'
});

const chatResponse = await chatClient.chat.completions.create({
  model: 'Qwen/Qwen3-VL-235B-A22B-Instruct',
  messages: [{
    role: 'user',
    content: [
      { type: 'text', text: 'æè¿°è¿™å¹…å›¾' },
      { type: 'image_url', image_url: { url: 'https://example.com/image.jpg' } }
    ]
  }],
  stream: true
});
```

---

## æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®¢æˆ·ç«¯å±‚ (Browser)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  React UI    â”‚  â”‚  æ˜Ÿäº‘SDKå±‚   â”‚  â”‚  çŠ¶æ€ç®¡ç†    â”‚  â”‚  çŸ¥è¯†åº“ç®¡ç†   â”‚â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  (Zustand)   â”‚  â”‚              â”‚â”‚
â”‚  â”‚ - å¯¹è¯ç•Œé¢   â”‚â—„â”€â”¤ - 3Dæ•°å­—äºº   â”‚â—„â”€â”¤              â”‚â—„â”€â”¤ - æ–‡ä»¶ä¸Šä¼    â”‚â”‚
â”‚  â”‚ - å¿«æ·æé—®   â”‚  â”‚ - è¯­éŸ³åˆæˆ   â”‚  â”‚ - å¯¹è¯å†å²   â”‚  â”‚ - æ–‡æœ¬æå–   â”‚â”‚
â”‚  â”‚ - å·¥å•åˆ—è¡¨   â”‚  â”‚ - æƒ…ç»ªè¡¨æƒ…   â”‚  â”‚ - å·¥å•è®°å½•   â”‚  â”‚ - åˆ†å—é¢„è§ˆ   â”‚â”‚
â”‚  â”‚ - å¯†é’¥ç®¡ç†   â”‚  â”‚ - åŠ¨ä½œæ§åˆ¶   â”‚  â”‚ - å¯†é’¥å­˜å‚¨   â”‚  â”‚ - å‘é‡ç®¡ç†   â”‚â”‚
â”‚  â”‚ - è¿æ¥æ§åˆ¶   â”‚  â”‚ - ç¦»çº¿æ¨¡å¼   â”‚  â”‚              â”‚  â”‚ - çŸ¥è¯†åº“åˆ—è¡¨ â”‚â”‚
â”‚  â”‚ - çŸ¥è¯†åº“ä¸Šä¼  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ HTTP/WebSocket
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æœåŠ¡ç«¯å±‚ (Node.js)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  APIæœåŠ¡     â”‚  â”‚  AIæœåŠ¡      â”‚  â”‚  å·¥å•æœåŠ¡     â”‚  â”‚  æ–‡ä»¶å¤„ç†     â”‚â”‚
â”‚  â”‚  (Express)   â”‚  â”‚  (é­”æ­)      â”‚  â”‚  (å†…å­˜å­˜å‚¨)   â”‚  â”‚  (å¤šæ ¼å¼)     â”‚â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚â”‚
â”‚  â”‚ - /chat      â”‚â”€â–ºâ”‚ - æ™ºèƒ½å¯¹è¯   â”‚â”€â–ºâ”‚ - å·¥å•åˆ›å»º   â”‚  â”‚ - PDFè§£æ    â”‚â”‚
â”‚  â”‚ - /ticket    â”‚  â”‚ - æµå¼å“åº”   â”‚  â”‚ - çŠ¶æ€æ›´æ–°   â”‚  â”‚ - DOCXè§£æ   â”‚â”‚
â”‚  â”‚ - /knowledge â”‚  â”‚ - å¤šæ¨¡æ€æ”¯æŒ â”‚  â”‚ - å·¥å•æŸ¥è¯¢   â”‚  â”‚ - TXT/MDè§£æ â”‚â”‚
â”‚  â”‚ - /upload    â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ - æ–‡æœ¬åˆ†å—   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  å‘é‡æ£€ç´¢å¼•æ“                                                      â”‚â”‚
â”‚  â”‚  - Qwen3-Embedding-8B å‘é‡åŒ–                                       â”‚â”‚
â”‚  â”‚  - ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢                                                 â”‚â”‚
â”‚  â”‚  - Top-K æ£€ç´¢                                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚                                     â”‚
â”‚                                     â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚  é¢„ç½®çŸ¥è¯†åº“  â”‚  â”‚  è‡ªå®šä¹‰çŸ¥è¯†åº“ â”‚                                    â”‚
â”‚  â”‚  - HRæ”¿ç­–    â”‚  â”‚  - ç”¨æˆ·ä¸Šä¼    â”‚                                    â”‚
â”‚  â”‚  - ITæ•…éšœ    â”‚  â”‚  - å‘é‡å­˜å‚¨   â”‚                                    â”‚
â”‚  â”‚  - FAQé—®ç­”   â”‚  â”‚  - æŒä¹…åŒ–     â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®å­˜å‚¨å±‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  localStorage â”‚  â”‚  å†…å­˜å‘é‡åº“  â”‚  â”‚  æ–‡ä»¶ç³»ç»Ÿ    â”‚                  â”‚
â”‚  â”‚  - å¯¹è¯å†å²  â”‚  â”‚  - å‘é‡ç´¢å¼•  â”‚  â”‚  (ä¸Šä¼ æ–‡ä»¶)  â”‚                  â”‚
â”‚  â”‚  - å·¥å•è®°å½•  â”‚  â”‚  - æ–‡æ¡£å—    â”‚  â”‚  - uploads/  â”‚                  â”‚
â”‚  â”‚  - APIå¯†é’¥   â”‚  â”‚  - å…ƒæ•°æ®    â”‚  â”‚              â”‚                  â”‚
â”‚  â”‚  - å‘é‡æ•°æ®  â”‚  â”‚              â”‚  â”‚              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›®å½•ç»“æ„

```
enterprise-assistant/
â”œâ”€â”€ src/                         # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ client/                  # å‰ç«¯ä»£ç  (React + TypeScript)
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Avatar/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AvatarController.ts         # SDKæ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AvatarContainer.tsx         # æ•°å­—äººå®¹å™¨ï¼ˆå«è¿æ¥ç®¡ç†ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Chat/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatBox.tsx                 # å¯¹è¯æ¡†ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx               # è¾“å…¥åŒºç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ QuickActions.tsx            # å¿«æ·æé—®ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Ticket/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TicketList.tsx              # å·¥å•åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TicketCard.tsx              # å·¥å•å¡ç‰‡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TicketDetail.tsx            # å·¥å•è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ Knowledge/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeManager.tsx        # çŸ¥è¯†åº“ç®¡ç†ä¸»ç•Œé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileUploader.tsx            # æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChunkPreview.tsx           # åˆ†å—é¢„è§ˆç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KnowledgeList.tsx           # çŸ¥è¯†åº“åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ VectorStats.tsx             # å‘é‡ç»Ÿè®¡ä¿¡æ¯
â”‚   â”‚   â”‚   â””â”€â”€ Common/
â”‚   â”‚   â”‚       â”œâ”€â”€ KeyInputModal.tsx           # å¯†é’¥è¾“å…¥å¼¹çª—
â”‚   â”‚   â”‚       â””â”€â”€ ConnectButton.tsx           # è¿æ¥æ§åˆ¶æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ chatStore.ts                    # å¯¹è¯çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ticketStore.ts                  # å·¥å•çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ keyStore.ts                     # APIå¯†é’¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ avatarStore.ts                  # æ•°å­—äººçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ knowledgeStore.ts               # çŸ¥è¯†åº“çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ chatService.ts                  # å¯¹è¯APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ticketService.ts                # å·¥å•APIæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ knowledgeService.ts             # çŸ¥è¯†åº“APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ App.tsx                             # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.tsx                            # å…¥å£æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                 # åç«¯ä»£ç  (Node.js + TypeScript)
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.routes.ts                   # å¯¹è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket.routes.ts                # å·¥å•è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge.routes.ts             # çŸ¥è¯†åº“è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ upload.routes.ts                # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ chatService.ts                  # å¯¹è¯å¤„ç†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ modelscopeService.ts            # é­”æ­AIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ragService.ts                   # RAGæ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ticketService.ts                # å·¥å•ç®¡ç†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ vectorService.ts                # å‘é‡å¤„ç†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ fileProcessor.ts                # æ–‡ä»¶å¤„ç†æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ chunkService.ts                 # æ–‡æœ¬åˆ†å—æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ textProcessor.ts                # æ–‡æœ¬å¤„ç†å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ vectorUtils.ts                  # å‘é‡è®¡ç®—å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ cosineSimilarity.ts             # ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ app.ts                              # Expressåº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ main.ts                             # åç«¯å…¥å£
â”‚   â”‚
â”‚   â””â”€â”€ data/                   # é¢„ç½®çŸ¥è¯†åº“æ•°æ®
â”‚       â””â”€â”€ knowledge/
â”‚           â”œâ”€â”€ hr_policy.json                   # HRæ”¿ç­–çŸ¥è¯†åº“
â”‚           â”œâ”€â”€ it_troubleshooting.json         # ITæ•…éšœçŸ¥è¯†åº“
â”‚           â””â”€â”€ faq.json                        # å¸¸è§é—®é¢˜çŸ¥è¯†åº“
â”‚
â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â””â”€â”€ uploads/                 # ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
â”œâ”€â”€ index.html                   # HTMLå…¥å£
â”œâ”€â”€ package.json                 # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.ts              # Viteé…ç½®
â”œâ”€â”€ tsconfig.json               # TypeScripté…ç½®
â”œâ”€â”€ tsconfig.server.json        # TypeScripté…ç½® (åç«¯)
â”œâ”€â”€ tailwind.config.js          # TailwindCSSé…ç½®
â”œâ”€â”€ postcss.config.js           # PostCSSé…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ claude.md                   # å¼€å‘æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

---

## ç¯å¢ƒé…ç½®

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
npm install
```

### é¢å¤–ä¾èµ–

```json
{
  "dependencies": {
    "openai": "^4.x",              // OpenAI SDK (ç”¨äºé­”æ­API)
    "pdf-parse": "^1.1.x",         // PDFæ–‡ä»¶è§£æ
    "mammoth": "^1.6.x",           // DOCXæ–‡ä»¶è§£æ
    "multer": "^1.4.x",            // æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶
    "uuid": "^9.0.x"               // ç”Ÿæˆå”¯ä¸€ID
  }
}
```

### ç¯å¢ƒå˜é‡

**.env** (å‰ç«¯ç¯å¢ƒå˜é‡ - å·²å¼ƒç”¨ï¼Œç°åœ¨ä½¿ç”¨å¯†é’¥è¾“å…¥å¼¹çª—)

```bash
# ä»¥ä¸‹é…ç½®å·²é€šè¿‡å¯†é’¥è¾“å…¥å¼¹çª—ç®¡ç†
# VITE_API_BASE_URL=/api
```

**.env.server** (åç«¯ç¯å¢ƒå˜é‡)

```bash
# æœåŠ¡å™¨é…ç½®
PORT=5178
NODE_ENV=development

# é­”æ­AIé…ç½®
MODELSCOPE_API_KEY=ms-de3c153b-5a19-41d1-bd3e-257a7eef7922
MODELSCOPE_BASE_URL=https://api-inference.modelscope.cn/v1
MODELSCOPE_CHAT_MODEL=Qwen/Qwen3-VL-235B-A22B-Instruct
MODELSCOPE_EMBEDDING_MODEL=Qwen/Qwen3-Embedding-8B

# æ–‡ä»¶ä¸Šä¼ é…ç½®
MAX_FILE_SIZE=10485760    # 10MB
UPLOAD_DIR=./public/uploads
```

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¯†é’¥ç®¡ç†

é¦–æ¬¡è®¿é—®æ—¶è‡ªåŠ¨å¼¹å‡ºå¯†é’¥é…ç½®çª—å£ï¼Œæ”¯æŒï¼š
- **ä½¿ç”¨å†…ç½®æµ‹è¯•å¯†é’¥**ï¼šå¿«é€Ÿä½“éªŒåŠŸèƒ½
- **è‡ªå®šä¹‰å¯†é’¥**ï¼šç”¨æˆ·è¾“å…¥è‡ªå·±çš„ API å¯†é’¥

å¯†é’¥ä¿å­˜åœ¨ localStorage ä¸­ï¼Œå¯éšæ—¶é€šè¿‡å³ä¸Šè§’"è®¾ç½®"æŒ‰é’®é‡æ–°é…ç½®ã€‚

**æ–‡ä»¶ä½ç½®**ï¼š
- `src/client/store/keyStore.ts` - å¯†é’¥çŠ¶æ€ç®¡ç†
- `src/client/components/Common/KeyInputModal.tsx` - å¯†é’¥è¾“å…¥å¼¹çª—

**å†…ç½®æµ‹è¯•å¯†é’¥**ï¼š
```typescript
const DEFAULT_KEYS: ApiKeys = {
  modelscopeApiKey: 'ms-de3c153b-5a19-41d1-bd3e-257a7eef7922',
  xingyunAppId: 'b70a23de5fe34312a5a2ac0e885b5118',
  xingyunAppSecret: '26d0815b4c7d4e3db207c3ee221dbf21'
};
```

### 2. æ•°å­—äººè¿æ¥æ§åˆ¶

æ‰‹åŠ¨æ§åˆ¶æ•°å­—äººè¿æ¥çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„ç§¯åˆ†æ¶ˆè€—ï¼š
- **æœªè¿æ¥**ï¼šæ˜¾ç¤º"è¿æ¥æ•°å­—äºº"æŒ‰é’®å’Œè¯´æ˜
- **è¿æ¥ä¸­**ï¼šæ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- **å·²è¿æ¥**ï¼šæ˜¾ç¤º"æ–­å¼€è¿æ¥"æŒ‰é’®
- **è¿æ¥å¤±è´¥**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å’Œé‡è¯•æŒ‰é’®

**è¿æ¥çŠ¶æ€ç®¡ç†**ï¼š
- æœªè¿æ¥æ—¶ï¼šæ•°å­—äººä¸æ˜¾ç¤ºï¼ŒèŠ‚çœèµ„æº
- è¿æ¥åï¼šæ˜¾ç¤º3Dæ•°å­—äººï¼Œå¯ä»¥è¿›è¡Œå¯¹è¯
- ç¦»çº¿æ¨¡å¼ï¼šå¯åˆ‡æ¢åˆ°ç¦»çº¿æ¨¡å¼ä¸æ¶ˆè€—ç§¯åˆ†

**æ–‡ä»¶ä½ç½®**ï¼š
- `src/client/components/Avatar/AvatarContainer.tsx`
- `src/client/store/avatarStore.ts`

### 3. HR æ”¿ç­–è§£ç­”

æ”¯æŒä»¥ä¸‹ HR ç›¸å…³å’¨è¯¢ï¼š

| ç±»åˆ« | é—®é¢˜ç±»å‹ |
|------|----------|
| è–ªèµ„ç¦åˆ© | å·¥èµ„å‘æ”¾ã€ç¤¾ä¿å…¬ç§¯é‡‘ã€å¹´ç»ˆå¥–ã€è¡¥è´´æ”¿ç­– |
| è€ƒå‹¤ä¼‘å‡ | æ‰“å¡åˆ¶åº¦ã€å¹´å‡è°ƒä¼‘ã€ç—…äº‹å‡ã€åŠ ç­è¡¥å¿ |
| æ‹›è˜å…¥èŒ | é¢è¯•æµç¨‹ã€å…¥èŒåŠç†ã€è¯•ç”¨æœŸã€è½¬æ­£è¯„ä¼° |
| åŸ¹è®­å‘å±• | å†…éƒ¨åŸ¹è®­ã€æ™‹å‡æœºåˆ¶ã€èŒä¸šè§„åˆ’ã€ç»©æ•ˆè€ƒæ ¸ |
| ç¦»èŒé€€ä¼‘ | ç¦»èŒæµç¨‹ã€ç«ä¸šåè®®ã€é€€ä¼‘æ”¿ç­– |

### 4. IT æ•…éšœæŠ¥ä¿®

æ”¯æŒä»¥ä¸‹ IT ç›¸å…³å’¨è¯¢ï¼š

| ç±»åˆ« | é—®é¢˜ç±»å‹ |
|------|----------|
| ç¡¬ä»¶æ•…éšœ | ç”µè„‘è“å±ã€æ‰“å°æœºæ•…éšœã€ç½‘ç»œæ–­çº¿ã€è®¾å¤‡æŸå |
| è½¯ä»¶é—®é¢˜ | Officeæ•…éšœã€ç³»ç»Ÿå´©æºƒã€è½¯ä»¶å®‰è£…ã€ç—…æ¯’æŸ¥æ€ |
| ç½‘ç»œé—®é¢˜ | VPNè¿æ¥ã€WiFiæ•…éšœã€é‚®ç®±é—®é¢˜ã€è´¦å·é”å®š |
| æƒé™ç®¡ç† | ç³»ç»Ÿæƒé™ã€æ–‡ä»¶è®¿é—®ã€è½¯ä»¶æˆæƒã€VPNæƒé™ |

### 5. å·¥å•ç³»ç»Ÿ

è‡ªåŠ¨æ•…éšœå·¥å•åŠŸèƒ½ï¼š
- æ£€æµ‹åˆ°æ•…éšœæ—¶è‡ªåŠ¨åˆ›å»ºå·¥å•
- å·¥å•çŠ¶æ€ï¼šå¾…å¤„ç† / å¤„ç†ä¸­ / å·²å®Œæˆ / å·²å…³é—­
- å·¥å•ä¼˜å…ˆçº§ï¼šä½ / ä¸­ / é«˜ / ç´§æ€¥
- å·¥å•è·Ÿè¸ªï¼šå®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦

**å·¥å•æ•°æ®ç»“æ„**ï¼š
```typescript
interface Ticket {
  id: string;
  title: string;
  description: string;
  category: 'hr' | 'it';
  priority: 'low' | 'medium' | 'high' | 'urgent';
  status: 'pending' | 'processing' | 'completed' | 'closed';
  createdAt: Date;
  updatedAt: Date;
}
```

### 6. å¿«æ·æé—®

é¢„è®¾å¸¸è§é—®é¢˜ï¼Œä¸€é”®å¿«é€Ÿå’¨è¯¢ï¼š

**HR å¿«æ·æé—®**ï¼š
- "å¹´å‡æ€ä¹ˆç®—ï¼Ÿ"
- "ç¤¾ä¿å…¬ç§¯é‡‘æ€ä¹ˆäº¤ï¼Ÿ"
- "è¯•ç”¨æœŸå¤šä¹…ï¼Ÿ"
- "æ€ä¹ˆç”³è¯·åŠ ç­ï¼Ÿ"
- "è½¬æ­£éœ€è¦ä»€ä¹ˆæ¡ä»¶ï¼Ÿ"

**IT å¿«æ·æé—®**ï¼š
- "ç”µè„‘è¿ä¸ä¸Šç½‘æ€ä¹ˆåŠï¼Ÿ"
- "æ‰“å°æœºåäº†æ€ä¹ˆæŠ¥ä¿®ï¼Ÿ"
- "å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ"
- "VPNæ€ä¹ˆè¿æ¥ï¼Ÿ"
- "Officeè½¯ä»¶æ‰“ä¸å¼€ï¼Ÿ"

---

## è‡ªå®šä¹‰çŸ¥è¯†åº“

### åŠŸèƒ½æ¦‚è¿°

ç”¨æˆ·å¯ä»¥ä¸Šä¼ è‡ªå·±çš„ä¼ä¸šæ–‡æ¡£ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. **æ–‡ä»¶è§£æ**ï¼šæ”¯æŒ .txt, .md, .pdf, .docx æ ¼å¼
2. **æ–‡æœ¬æå–**ï¼šä»æ–‡æ¡£ä¸­æå–çº¯æ–‡æœ¬å†…å®¹
3. **æ™ºèƒ½åˆ†å—**ï¼šæŒ‰è¯­ä¹‰è¾¹ç•Œå°†æ–‡æœ¬åˆ†å‰²æˆå°å—
4. **å‘é‡åŒ–**ï¼šä½¿ç”¨ Qwen3-Embedding-8B ç”Ÿæˆå‘é‡
5. **å­˜å‚¨ç´¢å¼•**ï¼šå‘é‡å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå…ƒæ•°æ®æŒä¹…åŒ–åˆ° localStorage
6. **è¯­ä¹‰æ£€ç´¢**ï¼šæ”¯æŒåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½æœç´¢

### æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

| æ ¼å¼ | æ‰©å±•å | è¯´æ˜ |
|------|--------|------|
| çº¯æ–‡æœ¬ | .txt | ç›´æ¥è¯»å– |
| Markdown | .md | ç›´æ¥è¯»å– |
| PDF | .pdf | ä½¿ç”¨ pdf-parse è§£æ |
| Word | .docx | ä½¿ç”¨ mammoth è§£æ |

### æ–‡æœ¬åˆ†å—ç­–ç•¥

```typescript
interface ChunkConfig {
  maxChunkSize: number;      // æœ€å¤§å—å¤§å° (å­—ç¬¦æ•°)ï¼Œé»˜è®¤ 500
  chunkOverlap: number;      // å—é‡å å¤§å°ï¼Œé»˜è®¤ 50
  minChunkSize: number;      // æœ€å°å—å¤§å°ï¼Œé»˜è®¤ 100
  splitByParagraph: boolean; // æŒ‰æ®µè½åˆ†å‰²ï¼Œé»˜è®¤ true
}

interface TextChunk {
  id: string;
  documentId: string;
  content: string;
  index: number;
  embedding?: number[];      // å‘é‡æ•°æ®
  metadata: {
    fileName: string;
    fileType: string;
    chunkSize: number;
    createdAt: Date;
  };
}
```

### å‘é‡å­˜å‚¨ç»“æ„

```typescript
interface VectorStore {
  documents: Map<string, Document>;
  chunks: Map<string, TextChunk>;
  chunkIndex: number[];      // Flat array for similarity calculation
}

interface Document {
  id: string;
  fileName: string;
  fileType: string;
  fileSize: number;
  uploadDate: Date;
  chunkCount: number;
  category: 'hr' | 'it' | 'general';
}
```

### æ–‡ä»¶ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶æ ¼å¼éªŒè¯   â”‚
â”‚  - å¤§å°æ£€æŸ¥     â”‚
â”‚  - æ ¼å¼æ£€æŸ¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶ä¸Šä¼        â”‚
â”‚  POST /upload   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æœ¬æå–       â”‚
â”‚  - PDFè§£æ      â”‚
â”‚  - DOCXè§£æ     â”‚
â”‚  - TXTè¯»å–      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æœ¬åˆ†å—       â”‚
â”‚  - æŒ‰æ®µè½åˆ†å‰²   â”‚
â”‚  - æŒ‰å¤§å°åˆ†å‰²   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é‡åŒ–         â”‚
â”‚  Qwen3-Embedding â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­˜å‚¨ç´¢å¼•       â”‚
â”‚  - å†…å­˜å‘é‡åº“   â”‚
â”‚  - å…ƒæ•°æ®æŒä¹…åŒ– â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ£€ç´¢æµç¨‹

```typescript
// ç”¨æˆ·æé—®
const query = "å¹´å‡æ€ä¹ˆè®¡ç®—ï¼Ÿ";

// 1. å‘é‡åŒ–æŸ¥è¯¢
const queryEmbedding = await embeddingClient.embeddings.create({
  model: 'Qwen/Qwen3-Embedding-8B',
  input: query
});

// 2. ç›¸ä¼¼åº¦æœç´¢
const similarChunks = await vectorService.search({
  vector: queryEmbedding.data[0].embedding,
  topK: 5,
  threshold: 0.7  // ç›¸ä¼¼åº¦é˜ˆå€¼
});

// 3. æ„å»ºæç¤ºè¯
const context = similarChunks.map(c => c.content).join('\n\n');
const prompt = `
åŸºäºä»¥ä¸‹çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ï¼š

çŸ¥è¯†åº“å†…å®¹ï¼š
${context}

ç”¨æˆ·é—®é¢˜ï¼š${query}

è¯·æä¾›å‡†ç¡®ã€è¯¦ç»†çš„å›ç­”ã€‚
`;

// 4. è°ƒç”¨å¯¹è¯æ¨¡å‹
const response = await chatClient.chat.completions.create({
  model: 'Qwen/Qwen3-VL-235B-A22B-Instruct',
  messages: [{ role: 'user', content: prompt }],
  stream: true
});
```

### çŸ¥è¯†åº“ç®¡ç†ç•Œé¢

åŠŸèƒ½åŒ…æ‹¬ï¼š
- **ä¸Šä¼ æ–°æ–‡ä»¶**ï¼šæ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ 
- **æ–‡ä»¶åˆ—è¡¨**ï¼šæ˜¾ç¤ºå·²ä¸Šä¼ çš„æ‰€æœ‰æ–‡ä»¶
- **åˆ†å—é¢„è§ˆ**ï¼šæŸ¥çœ‹æ–‡æ¡£æ˜¯å¦‚ä½•åˆ†å—çš„
- **åˆ é™¤æ–‡ä»¶**ï¼šç§»é™¤ä¸éœ€è¦çš„çŸ¥è¯†åº“
- **å‘é‡ç»Ÿè®¡**ï¼šæŸ¥çœ‹å‘é‡æ•°é‡ã€ç»´åº¦ç­‰ä¿¡æ¯
- **æµ‹è¯•æœç´¢**ï¼šè¾“å…¥æµ‹è¯•é—®é¢˜æŸ¥çœ‹æ£€ç´¢æ•ˆæœ

### çŸ¥è¯†åº“é«˜çº§åŠŸèƒ½

#### è‡ªåŠ¨åˆ†ç±»

ä¸Šä¼ æ–‡ä»¶åï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶ç±»åˆ«ï¼ˆHR/IT/é€šç”¨ï¼‰ï¼š

```typescript
// åŸºäºå…³é”®è¯å’Œå†…å®¹è‡ªåŠ¨åˆ†ç±»
function classifyDocument(content: string): 'hr' | 'it' | 'general' {
  const hrKeywords = ['è–ªèµ„', 'ç¤¾ä¿', 'å¹´å‡', 'è€ƒå‹¤', 'å…¥èŒ', 'ç¦»èŒ', 'ç»©æ•ˆ'];
  const itKeywords = ['ç”µè„‘', 'ç½‘ç»œ', 'æ‰“å°æœº', 'VPN', 'è½¯ä»¶', 'ç³»ç»Ÿ', 'æ•…éšœ'];

  const hrScore = hrKeywords.filter(k => content.includes(k)).length;
  const itScore = itKeywords.filter(k => content.includes(k)).length;

  if (hrScore > itScore) return 'hr';
  if (itScore > hrScore) return 'it';
  return 'general';
}
```

#### ç‰ˆæœ¬ç®¡ç†

åŒä¸€æ–‡ä»¶å¤šæ¬¡ä¸Šä¼ æ—¶ï¼š
- æ£€æµ‹æ–‡ä»¶åæ˜¯å¦å·²å­˜åœ¨
- å¦‚æœå­˜åœ¨ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯è¦†ç›–è¿˜æ˜¯æ–°å¢ç‰ˆæœ¬
- ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œæ”¯æŒç‰ˆæœ¬åˆ‡æ¢

```typescript
interface DocumentVersion {
  id: string;
  documentId: string;
  version: number;
  uploadDate: Date;
  chunkCount: number;
  isActive: boolean;
}
```

#### æ‰¹é‡æ“ä½œ

- **æ‰¹é‡ä¸Šä¼ **ï¼šæ”¯æŒä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶
- **æ‰¹é‡åˆ é™¤**ï¼šé€‰ä¸­å¤šä¸ªæ–‡ä»¶åæ‰¹é‡åˆ é™¤
- **æ‰¹é‡åˆ†ç±»**ï¼šé€‰ä¸­å¤šä¸ªæ–‡ä»¶åç»Ÿä¸€ä¿®æ”¹åˆ†ç±»

```typescript
interface BatchOperation {
  type: 'upload' | 'delete' | 'classify';
  documentIds: string[];
  category?: 'hr' | 'it' | 'general';
}
```

#### æœç´¢å’Œè¿‡æ»¤

çŸ¥è¯†åº“åˆ—è¡¨æ”¯æŒï¼š
- **æŒ‰åˆ†ç±»è¿‡æ»¤**ï¼šå…¨éƒ¨ / HR / IT / é€šç”¨
- **æŒ‰æ–‡ä»¶åæœç´¢**ï¼šæ¨¡ç³ŠåŒ¹é…æ–‡ä»¶å
- **æŒ‰ä¸Šä¼ æ—¶é—´æ’åº**ï¼šæœ€æ–°ä¼˜å…ˆ / æœ€æ—§ä¼˜å…ˆ
- **æŒ‰æ–‡ä»¶å¤§å°æ’åº**ï¼šå¤§æ–‡ä»¶ä¼˜å…ˆ / å°æ–‡ä»¶ä¼˜å…ˆ

#### å¯¼å‡º/å¯¼å…¥

- **å¯¼å‡ºçŸ¥è¯†åº“**ï¼šå°†æ‰€æœ‰çŸ¥è¯†åº“å…ƒæ•°æ®å¯¼å‡ºä¸º JSON
- **å¯¼å…¥çŸ¥è¯†åº“**ï¼šä» JSON æ–‡ä»¶æ¢å¤çŸ¥è¯†åº“é…ç½®

```typescript
interface ExportData {
  version: string;
  exportDate: Date;
  documents: Document[];
  chunks: TextChunk[];
}
```

---

## å¤šæ¨¡æ€å¯¹è¯

### åŠŸèƒ½æ¦‚è¿°

ä½¿ç”¨ Qwen/Qwen3-VL-235B-A22B-Instruct æ¨¡å‹ï¼Œæ”¯æŒï¼š
- **å›¾ç‰‡ç†è§£**ï¼šç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡è¿›è¡Œæé—®
- **æˆªå›¾ç²˜è´´**ï¼šæ”¯æŒç›´æ¥ç²˜è´´å‰ªè´´æ¿ä¸­çš„æˆªå›¾
- **å›¾æ–‡æ··åˆ**ï¼šæ–‡æœ¬å’Œå›¾ç‰‡ä¸€èµ·å‘é€

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ |
|------|------|
| IT æ•…éšœ | ä¸Šä¼ é”™è¯¯æˆªå›¾ï¼Œè¯¢é—®è§£å†³æ–¹æ¡ˆ |
| æ”¿ç­–è§£è¯» | ä¸Šä¼ æ”¿ç­–æ–‡ä»¶æˆªå›¾ï¼Œè¦æ±‚è§£é‡Š |
| æ“ä½œæŒ‡å¯¼ | ä¸Šä¼ ç•Œé¢æˆªå›¾ï¼Œè¯¢é—®å¦‚ä½•æ“ä½œ |

### å›¾ç‰‡ä¸Šä¼ æ–¹å¼

#### 1. ç‚¹å‡»ä¸Šä¼ 

```tsx
// ChatInput ç»„ä»¶
<button onClick={() => fileInputRef.current.click()}>
  <ImageIcon /> ä¸Šä¼ å›¾ç‰‡
</button>
<input
  type="file"
  ref={fileInputRef}
  accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
  onChange={handleImageUpload}
  hidden
/>
```

#### 2. æ‹–æ‹½ä¸Šä¼ 

```tsx
<div
  onDrop={handleDrop}
  onDragOver={(e) => e.preventDefault()}
>
  æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„
</div>
```

#### 3. ç²˜è´´ä¸Šä¼ 

```tsx
<div onPaste={handlePaste}>
  <textarea placeholder="æŒ‰ Ctrl+V ç²˜è´´å›¾ç‰‡" />
</div>

function handlePaste(e: ClipboardEvent) {
  const items = e.clipboardData?.items;
  for (let item of items || []) {
    if (item.type.startsWith('image/')) {
      const file = item.getAsFile();
      if (file) {
        processImage(file);
      }
    }
  }
}
```

### å¤šæ¨¡æ€å¯¹è¯æµç¨‹

```typescript
// ç”¨æˆ·å‘é€å¸¦å›¾ç‰‡çš„æ¶ˆæ¯
interface MultimodalMessage {
  type: 'text' | 'image';
  content: string;  // æ–‡æœ¬å†…å®¹æˆ–å›¾ç‰‡URL
}

// æ„å»ºå¤šæ¨¡æ€è¯·æ±‚
const response = await chatClient.chat.completions.create({
  model: 'Qwen/Qwen3-VL-235B-A22B-Instruct',
  messages: [{
    role: 'user',
    content: [
      { type: 'text', text: 'è¿™å¼ å›¾æ˜¯ä»€ä¹ˆé”™è¯¯ï¼Ÿ' },
      { type: 'image_url', image_url: { url: uploadedImageUrl } }
    ]
  }],
  stream: true
});
```

### å›¾ç‰‡å¤„ç†

```typescript
// å›¾ç‰‡è½¬ Base64
async function imageToBase64(file: File): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result as string);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// å‹ç¼©å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
async function compressImage(file: File, maxSizeKB: number = 500): Promise<Blob> {
  const img = new Image();
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  return new Promise((resolve) => {
    img.onload = () => {
      let width = img.width;
      let height = img.height;
      const ratio = Math.min(maxSizeKB * 1024 / (width * height), 1);

      canvas.width = width * ratio;
      canvas.height = height * ratio;

      ctx?.drawImage(img, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(resolve, 'image/jpeg', 0.8);
    };
    img.src = URL.createObjectURL(file);
  });
}
```

---

## ç•Œé¢è®¾è®¡

### è®¾è®¡è§„èŒƒ

```yaml
ä¸»é¢˜è‰²:
  ä¸»è‰²: "#2563EB"      # è“è‰² - ä¸“ä¸šã€å¯ä¿¡èµ–
  è¾…åŠ©è‰²: "#10B981"    # ç»¿è‰² - æˆåŠŸã€ç¡®è®¤
  è­¦å‘Šè‰²: "#F59E0B"    # æ©™è‰² - è­¦å‘Š
  é”™è¯¯è‰²: "#EF4444"    # çº¢è‰² - é”™è¯¯
  ä¸­æ€§è‰²: "#6B7280"    # ç°è‰² - æ¬¡è¦ä¿¡æ¯

å­—ä½“:
  æ ‡é¢˜: "font-bold text-xl"
  æ­£æ–‡: "text-base text-gray-700"
  å°å­—: "text-sm text-gray-500"

é—´è·:
  é¡µé¢è¾¹è·: "p-4 md:p-6"
  å¡ç‰‡é—´è·: "gap-4"
  å…ƒç´ é—´è·: "space-y-4"

åœ†è§’:
  æŒ‰é’®: "rounded-lg"
  å¡ç‰‡: "rounded-xl"
  å¯¹è¯æ¡†: "rounded-2xl"
```

### é¡µé¢å¸ƒå±€

#### ä¸»ç•Œé¢ï¼ˆå¯¹è¯é¡µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¶éƒ¨å¯¼èˆª                                    å¯†é’¥è®¾ç½® | æ¸…ç©º â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             â”‚ â”‚                                       â”‚ â”‚
â”‚  â”‚   æ•°å­—äºº    â”‚ â”‚           å¯¹è¯åŒºåŸŸ                   â”‚ â”‚
â”‚  â”‚   3D Avatar â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚             â”‚ â”‚  â”‚ æ¶ˆæ¯1: ç”¨æˆ·é—®é¢˜                  â”‚ â”‚ â”‚
â”‚  â”‚   è¿æ¥çŠ¶æ€   â”‚ â”‚  â”‚ æ¶ˆæ¯2: AIå›å¤                   â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚  â”‚ æ¶ˆæ¯3: ç”¨æˆ·é—®é¢˜                  â”‚ â”‚ â”‚
â”‚  â”‚   [è¿æ¥]    â”‚ â”‚  â”‚ ...                            â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                  â”‚                                       â”‚ â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è¾“å…¥åŒºåŸŸ                      [å›¾ç‰‡] [å‘é€]           â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...                             â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŸ¥è¯†åº“ç®¡ç†é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŸ¥è¯†åº“ç®¡ç†                             [è¿”å›] [+ ä¸Šä¼ æ–‡ä»¶]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰: [å…¨éƒ¨] [HR] [IT] [é€šç”¨]    æœç´¢: [____________]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶åˆ—è¡¨                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“„ HRæ”¿ç­–æ‰‹å†Œ.pdf                      HR | 2.3MB    [Ã—]â”‚ â”‚
â”‚  â”‚    åˆ†å—æ•°: 45 | ä¸Šä¼ æ—¶é—´: 2025-12-31                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ“„ ITæ•…éšœå¤„ç†æŒ‡å—.docx                 IT | 1.8MB    [Ã—]â”‚ â”‚
â”‚  â”‚    åˆ†å—æ•°: 32 | ä¸Šä¼ æ—¶é—´: 2025-12-30                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ“„ å…¬å¸è§„ç« åˆ¶åº¦.txt                    General | 500KB [Ã—]â”‚ â”‚
â”‚  â”‚    åˆ†å—æ•°: 12 | ä¸Šä¼ æ—¶é—´: 2025-12-29                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  å‘é‡ç»Ÿè®¡                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚æ–‡æ¡£æ€»æ•°: 3â”‚ â”‚åˆ†å—æ€»æ•°: 89â”‚ â”‚å‘é‡æ€»æ•°: 89â”‚ â”‚å­˜å‚¨å¤§å°: 5MBâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å·¥å•åˆ—è¡¨é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥å•ç®¡ç†                                 [åˆ›å»ºå·¥å•] [è¿”å›]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰: [å…¨éƒ¨] [å¾…å¤„ç†] [å¤„ç†ä¸­] [å·²å®Œæˆ]    åˆ†ç±»: [å…¨éƒ¨]â–¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ« #001 ç”µè„‘æ— æ³•è¿æ¥ç½‘ç»œ              å¾…å¤„ç† | é«˜ä¼˜å…ˆçº§â”‚ â”‚
â”‚  â”‚    åˆ›å»ºæ—¶é—´: 2025-12-31 10:30                        â”‚ â”‚
â”‚  â”‚    æè¿°: åŠå…¬å®¤ç½‘ç»œæ­£å¸¸ï¼Œä½†æˆ‘çš„ç”µè„‘è¿ä¸ä¸Š...         â”‚ â”‚
â”‚  â”‚    [æŸ¥çœ‹è¯¦æƒ…] [å¤„ç†] [å…³é—­]                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸ« #002 ç¤¾ä¿ç¼´çº³æ¯”ä¾‹å’¨è¯¢              å¾…å¤„ç† | ä¸­ä¼˜å…ˆçº§â”‚ â”‚
â”‚  â”‚    åˆ›å»ºæ—¶é—´: 2025-12-31 09:15                        â”‚ â”‚
â”‚  â”‚    æè¿°: è¯·é—®ä¸ªäººå’Œå…¬å¸å„æ‰¿æ‹…å¤šå°‘æ¯”ä¾‹ï¼Ÿ              â”‚ â”‚
â”‚  â”‚    [æŸ¥çœ‹è¯¦æƒ…] [å¤„ç†] [å…³é—­]                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶åº“

```tsx
// åŸºç¡€ç»„ä»¶
<Button variant="primary" size="md">
  æŒ‰é’®
</Button>

<Input placeholder="è¯·è¾“å…¥..." />
<Textarea rows={4} placeholder="è¯·è¾“å…¥..." />

<Modal isOpen={isOpen} onClose={() => setIsOpen(false)}>
  <ModalHeader>æ ‡é¢˜</ModalHeader>
  <ModalBody>å†…å®¹</ModalBody>
  <ModalFooter>
    <Button onClick={() => setIsOpen(false)}>å…³é—­</Button>
  </ModalFooter>
</Modal>

<Card>
  <CardHeader>æ ‡é¢˜</CardHeader>
  <CardBody>å†…å®¹</CardBody>
  <CardFooter>åº•éƒ¨</CardFooter>
</Card>

<Badge variant="success">æˆåŠŸ</Badge>
<Badge variant="warning">è­¦å‘Š</Badge>
<Badge variant="error">é”™è¯¯</Badge>

<Progress value={50} max={100} />
<Spinner size="md" />

<Toast type="success" message="æ“ä½œæˆåŠŸï¼" />
<Toast type="error" message="æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•" />
```

---

## æ•°æ®æŒä¹…åŒ–

### æŒä¹…åŒ–ç­–ç•¥

#### localStorage å­˜å‚¨å†…å®¹

```typescript
// å­˜å‚¨é”®å®šä¹‰
const STORAGE_KEYS = {
  API_KEYS: 'enterprise_assistant_api_keys',
  CHAT_HISTORY: 'enterprise_assistant_chat_history',
  TICKETS: 'enterprise_assistant_tickets',
  KNOWLEDGE_METADATA: 'enterprise_assistant_knowledge_metadata',
  VECTOR_CACHE: 'enterprise_assistant_vectors', // å‘é‡ç´¢å¼•ç¼“å­˜
};

// API å¯†é’¥
interface ApiKeysStorage {
  modelscopeApiKey: string;
  xingyunAppId: string;
  xingyunAppSecret: string;
}

// å¯¹è¯å†å²
interface ChatHistoryStorage {
  sessionId: string;
  messages: ChatMessage[];
  createdAt: Date;
}

// çŸ¥è¯†åº“å…ƒæ•°æ®ï¼ˆä¸åŒ…å«å‘é‡æœ¬èº«ï¼‰
interface KnowledgeMetadataStorage {
  documents: Document[];
  lastSyncTime: Date;
}
```

#### å‘é‡æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ

**æ–¹æ¡ˆä¸€ï¼šIndexedDBï¼ˆæ¨èï¼Œé€‚ç”¨äºå¤§å‘é‡ï¼‰**

```typescript
// ä½¿ç”¨ idb-keyval åº“
import { set, get, del, clear } from 'idb-keyval';

// å­˜å‚¨å‘é‡
async function saveVector(chunkId: string, vector: number[]) {
  await set(`vector_${chunkId}`, vector);
}

// è·å–å‘é‡
async function getVector(chunkId: string): Promise<number[] | undefined> {
  return await get(`vector_${chunkId}`);
}

// æ‰¹é‡å­˜å‚¨
async function saveVectors(vectors: Map<string, number[]>) {
  for (const [id, vector] of vectors.entries()) {
    await set(`vector_${id}`, vector);
  }
}
```

**æ–¹æ¡ˆäºŒï¼šå‹ç¼©å­˜å‚¨åˆ° localStorageï¼ˆé€‚ç”¨äºå°æ•°æ®é‡ï¼‰**

```typescript
// å‹ç¼©å‘é‡ï¼ˆé™ç»´æˆ–å–éƒ¨åˆ†ï¼‰
function compressVector(vector: number[], sampleRate: number = 2): number[] {
  return vector.filter((_, i) => i % sampleRate === 0);
}

// å­˜å‚¨åˆ° localStorage
function saveToLocalStorage(vectors: Map<string, number[]>) {
  const data = {};
  for (const [id, vector] of vectors.entries()) {
    data[id] = compressVector(vector);
  }
  localStorage.setItem(STORAGE_KEYS.VECTOR_CACHE, JSON.stringify(data));
}
```

#### æœåŠ¡é‡å¯æ¢å¤æµç¨‹

```
æœåŠ¡å¯åŠ¨
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŠ è½½å…ƒæ•°æ®     â”‚
â”‚  localStorage   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¢å¤çŸ¥è¯†åº“åˆ—è¡¨ â”‚
â”‚  æ–‡æ¡£ä¿¡æ¯       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥å‘é‡ç¼“å­˜   â”‚
â”‚  IndexedDB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
æœ‰ç¼“å­˜     æ— ç¼“å­˜
    â”‚         â”‚
    â”‚         â–¼
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  é‡æ–°å‘é‡åŒ–     â”‚
    â”‚   â”‚  åŸå§‹æ–‡æ¡£å—     â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¢å¤å‘é‡ç´¢å¼•   â”‚
â”‚  å‡†å¤‡å°±ç»ª       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®å¤‡ä»½

```typescript
// å¯¼å‡ºæ‰€æœ‰æ•°æ®
async function exportAllData(): Promise<string> {
  const data = {
    version: '1.0',
    exportDate: new Date().toISOString(),
    apiKeys: localStorage.getItem(STORAGE_KEYS.API_KEYS),
    chatHistory: localStorage.getItem(STORAGE_KEYS.CHAT_HISTORY),
    tickets: localStorage.getItem(STORAGE_KEYS.TICKETS),
    knowledgeMetadata: localStorage.getItem(STORAGE_KEYS.KNOWLEDGE_METADATA),
  };

  // ä» IndexedDB å¯¼å‡ºå‘é‡
  const vectors = await getAllVectors();

  return JSON.stringify({ ...data, vectors });
}

// å¯¼å…¥æ•°æ®
async function importData(jsonData: string): Promise<void> {
  const data = JSON.parse(jsonData);

  // æ¢å¤ localStorage
  Object.entries(data).forEach(([key, value]) => {
    if (key !== 'vectors') {
      localStorage.setItem(key, value);
    }
  });

  // æ¢å¤å‘é‡åˆ° IndexedDB
  if (data.vectors) {
    for (const [id, vector] of Object.entries(data.vectors)) {
      await saveVector(id, vector as number[]);
    }
  }
}
```

---

## å·¥å•ç³»ç»Ÿç»†èŠ‚

### å·¥å•è‡ªåŠ¨åˆ›å»º

åœ¨å¯¹è¯ä¸­æ£€æµ‹åˆ°é—®é¢˜æ—¶è‡ªåŠ¨åˆ›å»ºå·¥å•ï¼š

```typescript
// AI åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºå·¥å•
interface TicketDetection {
  shouldCreate: boolean;
  category: 'hr' | 'it';
  priority: 'low' | 'medium' | 'high' | 'urgent';
  title: string;
  description: string;
}

// ç¤ºä¾‹å¯¹è¯ä¸­æ£€æµ‹
const userMessage = "æˆ‘çš„ç”µè„‘è“å±äº†ï¼Œæ˜¾ç¤ºé”™è¯¯ä»£ç  0x0000";
const detection: TicketDetection = {
  shouldCreate: true,
  category: 'it',
  priority: 'high',
  title: 'ç”µè„‘è“å±æ•…éšœ',
  description: 'ç”¨æˆ·æŠ¥å‘Šç”µè„‘è“å±ï¼Œé”™è¯¯ä»£ç  0x0000'
};

// è‡ªåŠ¨åˆ›å»ºå·¥å•
if (detection.shouldCreate) {
  await createTicket({
    title: detection.title,
    description: detection.description,
    category: detection.category,
    priority: detection.priority
  });
}
```

### å·¥å•çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…å¤„ç†  â”‚ â† æ–°åˆ›å»ºçš„å·¥å•
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤„ç†ä¸­  â”‚ â† IT/HR äººå‘˜æ¥å•
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²å®Œæˆ  â”‚ â† é—®é¢˜å·²è§£å†³
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²å…³é—­  â”‚ â† ç”¨æˆ·ç¡®è®¤æˆ–è¶…æ—¶è‡ªåŠ¨å…³é—­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥å•é€šçŸ¥æœºåˆ¶

```typescript
// æµè§ˆå™¨é€šçŸ¥
function notifyTicket(ticket: Ticket) {
  if (Notification.permission === 'granted') {
    new Notification('æ–°å·¥å•é€šçŸ¥', {
      body: `${ticket.title}\nä¼˜å…ˆçº§: ${ticket.priority}`,
      icon: '/ticket-icon.png'
    });
  }
}

// åº”ç”¨å†…æç¤º
function showTicketToast(ticket: Ticket) {
  toast.info(`å·²åˆ›å»ºå·¥å• #${ticket.id}: ${ticket.title}`, {
    action: {
      label: 'æŸ¥çœ‹',
      onClick: () => navigateToTicket(ticket.id)
    }
  });
}
```

### å·¥å•å¯¼å‡º

```typescript
// å¯¼å‡ºä¸º CSV
function exportTicketsToCSV(tickets: Ticket[]): string {
  const headers = ['ID', 'æ ‡é¢˜', 'ç±»åˆ«', 'ä¼˜å…ˆçº§', 'çŠ¶æ€', 'åˆ›å»ºæ—¶é—´'];
  const rows = tickets.map(t => [
    t.id, t.title, t.category, t.priority, t.status, t.createdAt
  ]);
  return [headers, ...rows].map(row => row.join(',')).join('\n');
}

// å¯¼å‡ºä¸º Excel
async function exportTicketsToExcel(tickets: Ticket[]) {
  const worksheet = XLSX.utils.json_to_sheet(tickets);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, 'å·¥å•');
  XLSX.writeFile(workbook, `tickets_${Date.now()}.xlsx`);
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–

#### åˆ†å—ä¸Šä¼ å¤§æ–‡ä»¶

```typescript
async function uploadLargeFile(file: File, chunkSize: number = 5 * 1024 * 1024) {
  const chunks = Math.ceil(file.size / chunkSize);
  const fileId = uuid();

  for (let i = 0; i < chunks; i++) {
    const start = i * chunkSize;
    const end = Math.min(start + chunkSize, file.size);
    const chunk = file.slice(start, end);

    const formData = new FormData();
    formData.append('fileId', fileId);
    formData.append('chunkIndex', i.toString());
    formData.append('totalChunks', chunks.toString());
    formData.append('chunk', chunk);

    await fetch('/api/upload/chunk', {
      method: 'POST',
      body: formData
    });

    // æ›´æ–°è¿›åº¦
    const progress = ((i + 1) / chunks) * 100;
    updateUploadProgress(progress);
  }

  // åˆå¹¶åˆ†å—
  await fetch('/api/upload/merge', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ fileId, fileName: file.name })
  });
}
```

#### ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

```tsx
function UploadProgress({ progress }: { progress: number }) {
  return (
    <div className="w-full bg-gray-200 rounded-full h-2">
      <div
        className="bg-blue-600 h-2 rounded-full transition-all"
        style={{ width: `${progress}%` }}
      />
      <p className="text-sm text-gray-500 mt-1">{progress.toFixed(0)}%</p>
    </div>
  );
}
```

### å‘é‡æ£€ç´¢ä¼˜åŒ–

#### å‘é‡ç´¢å¼•

```typescript
// ä½¿ç”¨ HNSWï¼ˆå±‚æ¬¡åŒ–å¯å¯¼èˆªå°ä¸–ç•Œå›¾ï¼‰è¿‘ä¼¼æœç´¢
class VectorIndex {
  private index: HNSWLib;

  constructor(dimension: number) {
    this.index = new HNSWLib('Cosine', dimension);
  }

  addPoint(id: string, vector: number[]) {
    this.index.addPoint(vector, id);
  }

  search(vector: number[], k: number): string[] {
    return this.index.searchKnn(vector, k);
  }
}
```

#### æ‰¹é‡å‘é‡åŒ–

```typescript
// æ‰¹é‡å¤„ç†å‡å°‘ API è°ƒç”¨
async function batchEmbed(texts: string[], batchSize: number = 10) {
  const results = [];

  for (let i = 0; i < texts.length; i += batchSize) {
    const batch = texts.slice(i, i + batchSize);
    const response = await embeddingClient.embeddings.create({
      model: 'Qwen/Qwen3-Embedding-8B',
      input: batch
    });
    results.push(...response.data);
  }

  return results;
}
```

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–

```tsx
// è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–é•¿åˆ—è¡¨
import { FixedSizeList } from 'react-window';

function MessageList({ messages }: { messages: ChatMessage[] }) {
  return (
    <FixedSizeList
      height={600}
      itemCount={messages.length}
      itemSize={100}
      width="100%"
    >
      {({ index, style }) => (
        <div style={style}>
          <Message message={messages[index]} />
        </div>
      )}
    </FixedSizeList>
  );
}

// é˜²æŠ–æœç´¢
import { useDebouncedCallback } from 'use-debounce';

function KnowledgeSearch() {
  const debouncedSearch = useDebouncedCallback(
    (query: string) => {
      searchKnowledge(query);
    },
    500
  );

  return <input onChange={(e) => debouncedSearch(e.target.value)} />;
}

// æ‡’åŠ è½½å›¾ç‰‡
import { LazyLoadImage } from 'react-lazy-load-image-component';

function ChatImage({ src }: { src: string }) {
  return (
    <LazyLoadImage
      src={src}
      effect="blur"
      placeholderSrc="/placeholder.png"
    />
  );
}
```

---

## é”™è¯¯å¤„ç†

### æ–‡ä»¶å¤„ç†é”™è¯¯

```typescript
class FileProcessingError extends Error {
  constructor(
    message: string,
    public fileName: string,
    public code: string
  ) {
    super(message);
    this.name = 'FileProcessingError';
  }
}

// é”™è¯¯ç å®šä¹‰
enum FileErrorCode {
  INVALID_FORMAT = 'INVALID_FORMAT',
  FILE_TOO_LARGE = 'FILE_TOO_LARGE',
  PARSE_FAILED = 'PARSE_FAILED',
  EMPTY_CONTENT = 'EMPTY_CONTENT',
}

// é”™è¯¯å¤„ç†
async function processFile(file: File) {
  try {
    // éªŒè¯æ–‡ä»¶æ ¼å¼
    const allowedFormats = ['txt', 'md', 'pdf', 'docx'];
    const extension = file.name.split('.').pop()?.toLowerCase();

    if (!extension || !allowedFormats.includes(extension)) {
      throw new FileProcessingError(
        `ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${extension}`,
        file.name,
        FileErrorCode.INVALID_FORMAT
      );
    }

    // éªŒè¯æ–‡ä»¶å¤§å°
    const maxSize = 10 * 1024 * 1024; // 10MB
    if (file.size > maxSize) {
      throw new FileProcessingError(
        `æ–‡ä»¶è¿‡å¤§: ${(file.size / 1024 / 1024).toFixed(2)}MB`,
        file.name,
        FileErrorCode.FILE_TOO_LARGE
      );
    }

    // æå–æ–‡æœ¬
    const content = await extractText(file);
    if (!content || content.trim().length === 0) {
      throw new FileProcessingError(
        'æ–‡ä»¶å†…å®¹ä¸ºç©º',
        file.name,
        FileErrorCode.EMPTY_CONTENT
      );
    }

    return content;
  } catch (error) {
    if (error instanceof FileProcessingError) {
      toast.error(`å¤„ç†å¤±è´¥: ${error.message}`);
    }
    throw error;
  }
}
```

### API é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
interface ApiError {
  code: string;
  message: string;
  details?: any;
}

async function apiRequest<T>(
  url: string,
  options: RequestInit
): Promise<T> {
  try {
    const response = await fetch(url, options);

    if (!response.ok) {
      const error: ApiError = await response.json();
      throw new ApiErrorWrapper(error.code, error.message, error.details);
    }

    return await response.json();
  } catch (error) {
    if (error instanceof ApiErrorWrapper) {
      handleApiError(error);
    } else {
      toast.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
    }
    throw error;
  }
}

function handleApiError(error: ApiErrorWrapper) {
  switch (error.code) {
    case 'RATE_LIMIT_EXCEEDED':
      toast.error('è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•');
      break;
    case 'INVALID_API_KEY':
      toast.error('API å¯†é’¥æ— æ•ˆï¼Œè¯·é‡æ–°é…ç½®');
      break;
    case 'MODEL_NOT_AVAILABLE':
      toast.error('æ¨¡å‹æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•');
      break;
    default:
      toast.error(error.message);
  }
}
```

### ç½‘ç»œé‡è¯•æœºåˆ¶

```typescript
// æŒ‡æ•°é€€é¿é‡è¯•
async function retryWithBackoff<T>(
  fn: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000
): Promise<T> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;

      const delay = baseDelay * Math.pow(2, i);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  throw new Error('Max retries exceeded');
}

// ä½¿ç”¨ç¤ºä¾‹
const result = await retryWithBackoff(
  () => embeddingClient.embeddings.create({ model, input: text }),
  3,
  1000
);
```

### å‘é‡åŒ–é™çº§æ–¹æ¡ˆ

```typescript
// å½“å‘é‡åŒ– API å¤±è´¥æ—¶ï¼Œä½¿ç”¨å…³é”®è¯æœç´¢ä½œä¸ºé™çº§æ–¹æ¡ˆ
async function searchWithFallback(query: string) {
  try {
    // å°è¯•å‘é‡æœç´¢
    return await vectorSearch(query);
  } catch (error) {
    console.warn('å‘é‡æœç´¢å¤±è´¥ï¼Œé™çº§åˆ°å…³é”®è¯æœç´¢', error);

    // é™çº§åˆ°å…³é”®è¯æœç´¢
    return await keywordSearch(query);
  }
}

async function keywordSearch(query: string): Promise<TextChunk[]> {
  const chunks = getAllChunks();
  const keywords = query.split(/\s+/);

  return chunks
    .map(chunk => {
      const score = keywords.reduce((sum, keyword) => {
        return sum + (chunk.content.includes(keyword) ? 1 : 0);
      }, 0);
      return { chunk, score };
    })
    .filter(({ score }) => score > 0)
    .sort((a, b) => b.score - a.score)
    .slice(0, 5)
    .map(({ chunk }) => chunk);
}
```

---

## æµ‹è¯•ä¸éƒ¨ç½²

### å•å…ƒæµ‹è¯•

```typescript
// ä½¿ç”¨ Vitest
import { describe, it, expect } from 'vitest';
import { classifyDocument } from './classifier';

describe('æ–‡æ¡£åˆ†ç±»', () => {
  it('åº”è¯¥æ­£ç¡®åˆ†ç±» HR æ–‡æ¡£', () => {
    const content = 'å…¬å¸è–ªèµ„åˆ¶åº¦ï¼šåŸºæœ¬å·¥èµ„ã€ç»©æ•ˆå¥–é‡‘ã€ç¤¾ä¿å…¬ç§¯é‡‘';
    expect(classifyDocument(content)).toBe('hr');
  });

  it('åº”è¯¥æ­£ç¡®åˆ†ç±» IT æ–‡æ¡£', () => {
    const content = 'ç”µè„‘æ— æ³•è¿æ¥ç½‘ç»œï¼Œæ‰“å°æœºæ•…éšœï¼Œç³»ç»Ÿå´©æºƒ';
    expect(classifyDocument(content)).toBe('it');
  });

  it('åº”è¯¥æ­£ç¡®åˆ†ç±»é€šç”¨æ–‡æ¡£', () => {
    const content = 'å…¬å¸ä»‹ç»ã€å‘å±•å†ç¨‹ã€ç»„ç»‡æ¶æ„';
    expect(classifyDocument(content)).toBe('general');
  });
});
```

### é›†æˆæµ‹è¯•

```typescript
describe('çŸ¥è¯†åº“ä¸Šä¼ æµç¨‹', () => {
  it('åº”è¯¥æˆåŠŸä¸Šä¼ å¹¶å¤„ç†æ–‡æ¡£', async () => {
    const file = new File(['æµ‹è¯•å†…å®¹'], 'test.txt', { type: 'text/plain' });

    const response = await uploadFile(file);

    expect(response.documentId).toBeDefined();
    expect(response.chunkCount).toBeGreaterThan(0);
  });

  it('åº”è¯¥æ­£ç¡®æ£€ç´¢çŸ¥è¯†åº“', async () => {
    const results = await searchKnowledge('å¹´å‡æ€ä¹ˆç®—ï¼Ÿ');

    expect(results.length).toBeGreaterThan(0);
    expect(results[0].content).toContain('å¹´å‡');
  });
});
```

### éƒ¨ç½²æ­¥éª¤

#### å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®
# å‰ç«¯: http://localhost:5173
# åç«¯: http://localhost:5178
```

#### ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»ºå‰ç«¯
npm run build

# å¯åŠ¨åç«¯ï¼ˆä½¿ç”¨ PM2ï¼‰
npx pm2 start src/server/main.ts --name enterprise-assistant

# æˆ–è€…ä½¿ç”¨ Docker
docker build -t enterprise-assistant .
docker run -p 80:80 enterprise-assistant
```

#### Docker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./

EXPOSE 80
CMD ["node", "src/server/main.ts"]
```

#### ç¯å¢ƒå˜é‡æ¸…å•

```bash
# ç”Ÿäº§ç¯å¢ƒ (.env.production)
NODE_ENV=production
PORT=80

# é­”æ­ AI
MODELSCOPE_API_KEY=<ç”Ÿäº§ç¯å¢ƒå¯†é’¥>
MODELSCOPE_BASE_URL=https://api-inference.modelscope.cn/v1
MODELSCOPE_CHAT_MODEL=Qwen/Qwen3-VL-235B-A22B-Instruct
MODELSCOPE_EMBEDDING_MODEL=Qwen/Qwen3-Embedding-8B

# æ–‡ä»¶ä¸Šä¼ 
MAX_FILE_SIZE=10485760
UPLOAD_DIR=/var/uploads

# CORSï¼ˆå¦‚æœå‰åç«¯åˆ†ç¦»ï¼‰
CORS_ORIGIN=https://your-domain.com
```

---

## å¯†é’¥ç®¡ç†

### å¯†é’¥è·å–æ–¹å¼

| æœåŠ¡ | è·å–åœ°å€ | è¯´æ˜ |
|------|----------|------|
| é­”æ­ç¤¾åŒº | https://modelscope.cn/ | æä¾› Qwen3-VLã€Qwen3-Embedding ç­‰å¤§æ¨¡å‹API |
| é­”çæ˜Ÿäº‘ | https://nebula.xingyun3d.com/ | æä¾›3Dæ•°å­—äººé©±åŠ¨æœåŠ¡ |

### å¯†é’¥å­˜å‚¨æµç¨‹

```
ç”¨æˆ·é¦–æ¬¡è®¿é—®
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KeyInputModal   â”‚
â”‚  - é€‰æ‹©ä½¿ç”¨å†…ç½®å¯†é’¥â”‚
â”‚  - æˆ–è¾“å…¥è‡ªå®šä¹‰å¯†é’¥â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    localStorage
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   keyStore      â”‚
â”‚  - getXingyunAppId()
â”‚  - getXingyunAppSecret()
â”‚  - getModelScopeKey()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯†é’¥ä¼ é€’

- **å‰ç«¯ â†’ åç«¯**ï¼šé€šè¿‡ HTTP è¯·æ±‚ä½“ä¼ é€’ `apiKey` å­—æ®µ
- **AvatarContainer**ï¼šç›´æ¥ä» keyStore è¯»å–å¯†é’¥åˆå§‹åŒ–æ•°å­—äºº

---

## å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„

- [ ] é¡¹ç›®ç»“æ„åˆå§‹åŒ–
- [ ] å‰åç«¯åŸºç¡€æ¡†æ¶æ­å»º
- [ ] Vite é…ç½®å’Œå¼€å‘ç¯å¢ƒ
- [ ] æ•°å­—äºº SDK é›†æˆ
- [ ] å¯†é’¥ç®¡ç†åŠŸèƒ½
- [ ] è¿æ¥æ§åˆ¶åŠŸèƒ½

### Phase 2: å¯¹è¯ç³»ç»Ÿ

- [ ] å¯¹è¯ API å®ç°
- [ ] SSE æµå¼å“åº”
- [ ] æ¶ˆæ¯çŠ¶æ€ç®¡ç†
- [ ] æ•°å­—äººè¯­éŸ³åŒæ­¥

### Phase 3: å‘é‡çŸ¥è¯†åº“

- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] æ–‡æœ¬æå–æœåŠ¡ï¼ˆPDF/DOCX/TXTï¼‰
- [ ] æ–‡æœ¬åˆ†å—ç®—æ³•
- [ ] å‘é‡åŒ–æœåŠ¡ï¼ˆQwen3-Embedding-8Bï¼‰
- [ ] å‘é‡å­˜å‚¨å’ŒæŒä¹…åŒ–
- [ ] è¯­ä¹‰æ£€ç´¢æœåŠ¡
- [ ] çŸ¥è¯†åº“ç®¡ç†ç•Œé¢

### Phase 4: ä¸šåŠ¡åŠŸèƒ½

- [ ] HR æ”¿ç­–è§£ç­”åœºæ™¯
- [ ] IT æ•…éšœæŠ¥ä¿®åœºæ™¯
- [ ] å·¥å•åˆ›å»ºå’Œç®¡ç†
- [ ] å¿«æ·æé—®åŠŸèƒ½
- [ ] é¢„ç½®çŸ¥è¯†åº“æ•°æ®

### Phase 5: ä½“éªŒä¼˜åŒ–

- [ ] ç•Œé¢ç¾åŒ–
- [ ] å“åº”å¼é€‚é…
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å¤šæ¨¡æ€æ”¯æŒï¼ˆå›¾ç‰‡é—®ç­”ï¼‰

---

## é­”æ­AIæ¨¡å‹è¿æ¥å®ç°

### ModelScopeService ç±»

æ–‡ä»¶ä½ç½®ï¼š`src/server/services/modelscopeService.ts`

å°è£…é­”æ­ç¤¾åŒºä¸¤ä¸ª AI æ¨¡å‹çš„è°ƒç”¨ï¼š

```typescript
import OpenAI from 'openai';

const MODELSCOPE_BASE_URL = process.env.MODELSCOPE_BASE_URL || 'https://api-inference.modelscope.cn/v1';
const MODELSCOPE_EMBEDDING_MODEL = 'Qwen/Qwen3-Embedding-8B';
const MODELSCOPE_CHAT_MODEL = 'Qwen/Qwen3-VL-235B-A22B-Instruct';

export class ModelScopeService {
  private client: OpenAI;

  constructor(apiKey: string) {
    this.client = new OpenAI({
      apiKey: apiKey,
      baseURL: MODELSCOPE_BASE_URL
    });
  }

  // æ–‡æœ¬å‘é‡åŒ–
  async generateEmbedding(text: string): Promise<number[]> {
    const response = await this.client.embeddings.create({
      model: MODELSCOPE_EMBEDDING_MODEL,
      input: text,
      encoding_format: 'float'
    });
    return Array.from(response.data[0].embedding);
  }

  // æµå¼å¯¹è¯
  async *chatStream(messages: ChatMessage[]): AsyncGenerator<string> {
    const stream = await this.client.chat.completions.create({
      model: MODELSCOPE_CHAT_MODEL,
      messages: messages as any,
      stream: true
    });
    for await (const chunk of stream) {
      const content = chunk.choices[0]?.delta?.content;
      if (content) yield content;
    }
  }
}
```

### VectorStoreService ç±»

æ–‡ä»¶ä½ç½®ï¼š`src/server/services/vectorStoreService.ts`

å‘é‡å­˜å‚¨å’Œæ£€ç´¢æœåŠ¡ï¼š

```typescript
export class VectorStoreService {
  private documents: Map<string, VectorDocument> = new Map();

  // æ·»åŠ æ–‡æ¡£
  addDocument(content: string, embedding: number[], metadata: any): string;

  // å‘é‡æ£€ç´¢ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰
  search(queryEmbedding: number[], topK: number, threshold: number): VectorSearchResult[];

  // åˆ é™¤æ–‡æ¡£
  deleteByFilename(filename: string): number;

  // è·å–ç»Ÿè®¡
  getStats();
}
```

### RAGService ç±»

æ–‡ä»¶ä½ç½®ï¼š`src/server/services/ragService.ts`

RAG æ£€ç´¢æœåŠ¡ï¼š

```typescript
export class RAGService {
  private modelScopeService: ModelScopeService | null = null;

  // æ£€ç´¢ç›¸å…³æ–‡æ¡£
  async retrieveDocuments(query: string, topK: number, threshold: number): Promise<VectorSearchResult[]>;

  // æ·»åŠ æ–‡æ¡£åˆ°çŸ¥è¯†åº“
  async addDocumentsToKnowledge(items: Array<{content: string; metadata: any}>, apiKey: string): Promise<void>;

  // åˆ é™¤çŸ¥è¯†
  deleteKnowledge(filename: string): number;

  // è·å–çŸ¥è¯†åº“ç»Ÿè®¡
  getKnowledgeStats();
}
```

### ChatService ç±»ï¼ˆå·²æ›´æ–°ï¼‰

æ–‡ä»¶ä½ç½®ï¼š`src/server/services/chatService.ts`

é›†æˆ RAG å’Œæµå¼å“åº”ï¼š

```typescript
export class ChatService {
  // æµå¼å¤„ç†å¯¹è¯ï¼ˆå¸¦ RAGï¼‰
  async *processChatStream(request: ChatRequest): AsyncGenerator<string | VectorSearchResult[]> {
    // 1. RAG æ£€ç´¢
    const sources = await ragService.retrieveDocuments(message, 5, 0.5);

    // 2. æ„å»ºä¸Šä¸‹æ–‡
    const messages = [
      { role: 'system', content: SYSTEM_PROMPT + ragContext },
      ...conversationHistory,
      { role: 'user', content: message }
    ];

    // 3. å…ˆè¿”å›çŸ¥è¯†åº“å¼•ç”¨
    if (sources.length > 0) yield sources;

    // 4. æµå¼ç”Ÿæˆå›å¤
    for await (const chunk of aiService.chatStream(messages)) {
      yield chunk;
    }
  }
}
```

---

## æ•°å­—äººæµå¼è¯´è¯ä¸å¯Œæ–‡æœ¬è¾“å‡º

### æµå¼è¯´è¯å®ç°

åœ¨ `src/client/App.tsx` ä¸­å®ç°æ•°å­—äººæµå¼è¯´è¯ï¼š

```typescript
const handleSendMessage = async (content: string, image?: string) => {
  // æµå¼è¯´è¯çŠ¶æ€è¿½è¸ª
  let isFirstChunk = true;
  let speakingBuffer = '';

  await sendMessageStream(
    request,

    // onChunk: æ¯æ”¶åˆ°æ–‡æœ¬å—
    (chunk: string) => {
      appendCurrentResponse(chunk);  // æ›´æ–° UI

      // æ•°å­—äººè¯´è¯ - æ™ºèƒ½åˆ†æ®µ
      if (controllerRef.current) {
        speakingBuffer += chunk;

        // åˆ†æ®µæ¡ä»¶ï¼šé•¿åº¦>=10 æˆ–é‡åˆ°æ ‡ç‚¹
        if (speakingBuffer.length >= 10 || /[ã€‚ï¼ï¼Ÿï¼Œã€ï¼›ï¼š.!?,:;]/.test(chunk)) {
          controllerRef.current.speakStream(speakingBuffer, isFirstChunk, false);
          speakingBuffer = '';
          isFirstChunk = false;
        }
      }
    },

    // onComplete: æµå¼å®Œæˆ
    () => {
      // å‘é€å‰©ä½™å†…å®¹
      if (controllerRef.current && speakingBuffer) {
        controllerRef.current.speakStream(speakingBuffer, isFirstChunk, true);
      }
      // ä¿å­˜åˆ°å†å²
      addMessage({ role: 'assistant', content: currentResponse, sources: currentSources });
    }
  );
};
```

### AvatarController æµå¼è¯´è¯æ–¹æ³•

æ–‡ä»¶ä½ç½®ï¼š`src/client/components/Avatar/AvatarController.ts`

```typescript
export class AvatarController {
  // æµå¼è¯´è¯
  speakStream(content: string, isStart: boolean, isEnd: boolean): void {
    if (!this.sdk) return;
    this.sdk.speak(content, isStart, isEnd);
  }
}
```

### å¯Œæ–‡æœ¬æ ¼å¼åŒ–

æ–‡ä»¶ä½ç½®ï¼š`src/client/components/Chat/ChatBox.tsx`

æ”¯æŒ **ç²—ä½“** ç­‰æ ‡è®°ï¼š

```typescript
function formatContent(content: string) {
  return content
    .split('\n')
    .map((line, i) => {
      // **ç²—ä½“** â†’ <strong>
      let formattedLine = line.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
      // *æ–œä½“* â†’ <em>
      formattedLine = formattedLine.replace(/\*([^*]+)\*/g, '<em>$1</em>');

      return (
        <p
          key={i}
          dangerouslySetInnerHTML={{ __html: formattedLine || '&nbsp;' }}
          className="my-1"
        />
      );
    });
}
```

### çŸ¥è¯†åº“å¼•ç”¨å±•ç¤º

```typescript
function KnowledgeSources({ sources }: { sources: any[] }) {
  if (!sources || sources.length === 0) return null;

  return (
    <div className="mt-2 p-2 bg-blue-50 rounded-lg border border-blue-200">
      <p className="text-xs text-blue-600 font-medium mb-1">
        ğŸ“š çŸ¥è¯†åº“å¼•ç”¨
      </p>
      {sources.slice(0, 3).map((source, index) => (
        <div key={index} className="text-xs text-slate-600">
          [{index + 1}] {source.content?.slice(0, 60)}...
          <span className="ml-2 text-blue-500">
            {(source.score * 100).toFixed(0)}%
          </span>
        </div>
      ))}
    </div>
  );
}
```

### SSE æµå¼å“åº”åè®®

åç«¯è·¯ç”± `src/server/routes/chat.routes.ts`ï¼š

```typescript
router.post('/stream', async (req, res) => {
  // SSE Headers
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  for await (const result of stream) {
    if (typeof result === 'string') {
      res.write(`data: ${JSON.stringify({ type: 'content', data: result })}\n\n`);
    } else {
      res.write(`data: ${JSON.stringify({ type: 'sources', data: result })}\n\n`);
    }
  }

  res.write(`data: ${JSON.stringify({ type: 'end' })}\n\n`);
});
```

å‰ç«¯æœåŠ¡ `src/client/services/chatService.ts`ï¼š

```typescript
export async function sendMessageStream(
  request: ChatRequest,
  onChunk: (chunk: string) => void,
  onSources: (sources: KnowledgeSource[]) => void,
  onComplete: () => void,
  onError: (error: string) => void
): Promise<void> {
  const response = await fetch('/api/chat/stream', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(request)
  });

  const reader = response.body?.getReader();
  const decoder = new TextDecoder();
  let buffer = '';

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split('\n');
    buffer = lines.pop() || '';

    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const data = JSON.parse(line.slice(6));
        if (data.type === 'content') onChunk(data.data);
        else if (data.type === 'sources') onSources(data.data);
        else if (data.type === 'end') onComplete();
        else if (data.type === 'error') onError(data.data);
      }
    }
  }
}
```

### æµå¼å“åº”çŠ¶æ€ç®¡ç†

æ–‡ä»¶ä½ç½®ï¼š`src/client/store/chatStore.ts`

```typescript
interface ChatStoreState {
  // åŸºç¡€çŠ¶æ€
  sessionId: string;
  messages: ChatMessage[];
  isLoading: boolean;
  sources: KnowledgeSource[];

  // æµå¼å“åº”çŠ¶æ€
  currentResponse: string;    // å½“å‰æµå¼å“åº”ï¼ˆç´¯ç§¯ï¼‰
  currentSources: KnowledgeSource[]; // å½“å‰çŸ¥è¯†åº“å¼•ç”¨
  isProcessing: boolean;      // æ˜¯å¦æ­£åœ¨å¤„ç†

  // æµå¼å“åº” Actions
  appendCurrentResponse: (text: string) => void;
  setCurrentResponse: (response: string) => void;
  setCurrentSources: (sources: KnowledgeSource[]) => void;
  setProcessing: (processing: boolean) => void;
}
```

---

## SDK é…ç½®å‚è€ƒ

### æ˜Ÿäº‘æ•°å­—äºº SDK åˆå§‹åŒ–

```typescript
const LiteSDK = new XmovAvatar({
  containerId: '#sdk',
  appId: xingyunAppId,
  appSecret: xingyunAppSecret,
  gatewayServer: 'https://nebula-agent.xingyun3d.com/user/v1/ttsa/session',

  onMessage(message) {
    console.log('SDK message:', message);
  },

  onStateChange(state: string) {
    console.log('SDK State Change:', state);
  },

  onStatusChange(status) {
    console.log('SDK Status Change:', status);
  },

  onVoiceStateChange(status: string) {
    console.log('Voice status:', status);
  },

  enableLogger: false,
});
```

### æ•°å­—äººçŠ¶æ€æ§åˆ¶

```typescript
// åˆå§‹åŒ–
await LiteSDK.init({ onDownloadProgress: (p) => console.log(p) });

// è®©æ•°å­—äººè¯´è¯
LiteSDK.speak("æ¬¢è¿ä½¿ç”¨ä¼ä¸šæ™ºèƒ½åŠ©æ‰‹", true, true);

// åˆ‡æ¢çŠ¶æ€
LiteSDK.listen();   // å€¾å¬çŠ¶æ€
LiteSDK.think();    // æ€è€ƒçŠ¶æ€
LiteSDK.idle();     // å¾…æœºçŠ¶æ€

// ç¦»çº¿æ¨¡å¼ï¼ˆä¸æ¶ˆè€—ç§¯åˆ†ï¼‰
LiteSDK.offlineMode();
LiteSDK.onlineMode();

// é”€æ¯è¿æ¥
LiteSDK.destroy();
```

### é­”æ­ AI æœåŠ¡é›†æˆ

```typescript
import OpenAI from 'openai';

const client = new OpenAI({
  baseURL: 'https://api-inference.modelscope.cn/v1',
  apiKey: 'ms-de3c153b-5a19-41d1-bd3e-257a7eef7922'
});

// å‘é‡åŒ–
const embeddingResponse = await client.embeddings.create({
  model: 'Qwen/Qwen3-Embedding-8B',
  input: 'ä½ å¥½',
  encoding_format: 'float'
});

// å¯¹è¯ï¼ˆæ”¯æŒå¤šæ¨¡æ€ï¼‰
const chatResponse = await client.chat.completions.create({
  model: 'Qwen/Qwen3-VL-235B-A22B-Instruct',
  messages: [{
    role: 'user',
    content: [
      { type: 'text', text: 'æè¿°è¿™å¹…å›¾' },
      { type: 'image_url', image_url: { url: 'https://example.com/image.jpg' } }
    ]
  }],
  stream: true
});

for (const chunk of chatResponse) {
  if (chunk.choices) {
    console.log(chunk.choices[0].delta.content);
  }
}
```

---

## API è®¾è®¡

### POST /api/chat/stream
æµå¼å¯¹è¯æ¥å£ï¼ˆSSEï¼‰

```typescript
interface ChatRequest {
  message: string;
  sessionId: string;
  category?: 'hr' | 'it' | 'general';
  conversationHistory?: ChatMessage[];
  apiKeys?: {
    modelScopeApiKey?: string;
  };
}

interface ChatResponse {
  content: string;
  sources?: KnowledgeSource[];
  ticket?: Ticket;
}
```

### POST /api/upload
ä¸Šä¼ çŸ¥è¯†åº“æ–‡ä»¶

```typescript
interface UploadResponse {
  documentId: string;
  fileName: string;
  chunkCount: number;
  vectorsGenerated: number;
}
```

### GET /api/knowledge
è·å–çŸ¥è¯†åº“åˆ—è¡¨

```typescript
interface KnowledgeListResponse {
  documents: Document[];
  totalChunks: number;
  totalVectors: number;
}
```

### DELETE /api/knowledge/:id
åˆ é™¤çŸ¥è¯†åº“æ–‡æ¡£

```typescript
interface DeleteResponse {
  success: boolean;
  deletedChunks: number;
}
```

### GET /api/tickets
è·å–å·¥å•åˆ—è¡¨

```typescript
interface TicketListResponse {
  tickets: Ticket[];
  total: number;
}
```

### POST /api/tickets
åˆ›å»ºå·¥å•

```typescript
interface CreateTicketRequest {
  title: string;
  description: string;
  category: 'hr' | 'it';
  priority?: 'low' | 'medium' | 'high' | 'urgent';
}

interface CreateTicketResponse {
  ticket: Ticket;
}
```

### PATCH /api/tickets/:id
æ›´æ–°å·¥å•çŠ¶æ€

```typescript
interface UpdateTicketRequest {
  status?: 'pending' | 'processing' | 'completed' | 'closed';
}
```

---

## æ³¨æ„äº‹é¡¹

1. **å¯†é’¥å®‰å…¨**ï¼šç”Ÿäº§ç¯å¢ƒä¸­å¯†é’¥åº”å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œä¸åº”æš´éœ²ç»™å‰ç«¯
2. **ç§¯åˆ†æ§åˆ¶**ï¼šé•¿æ—¶é—´ä¸ä½¿ç”¨æ—¶åº”åˆ‡æ¢åˆ°ç¦»çº¿æ¨¡å¼
3. **ç½‘ç»œè¦æ±‚**ï¼šSDK éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
4. **æµè§ˆå™¨å…¼å®¹**ï¼šå»ºè®®ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Edgeã€Safariï¼‰
5. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½® HTTPSï¼ˆSDK è¦æ±‚ï¼‰
6. **æ–‡ä»¶å¤§å°**ï¼šä¸Šä¼ æ–‡ä»¶é™åˆ¶ä¸º 10MBï¼Œå¯åœ¨é…ç½®ä¸­è°ƒæ•´
7. **å‘é‡å­˜å‚¨**ï¼šå‘é‡æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé‡å¯åéœ€è¦é‡æ–°å‘é‡åŒ–ï¼ˆæˆ–ä½¿ç”¨ IndexedDB æŒä¹…åŒ–ï¼‰
8. **å›¾ç‰‡å¤„ç†**ï¼šä¸Šä¼ å›¾ç‰‡ä¼šè‡ªåŠ¨å‹ç¼©ä»¥èŠ‚çœæµé‡
9. **API é™æµ**ï¼šé­”æ­ API æœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œéœ€è¦å®ç°è¯·æ±‚é˜Ÿåˆ—

---

## å‚è€ƒé¡¹ç›®

æœ¬é¡¹ç›®å‚è€ƒäº†åŒç›®å½•ä¸‹çš„å·²å®Œæˆé¡¹ç›®ï¼š
- `emotion-companion`: æƒ…ç»ªé™ªä¼´åŠ©æ‰‹
- `subject-tutoring`: å­¦ç§‘è¾…å¯¼åŠ©æ‰‹
- `health-assistant`: å¥åº·å’¨è¯¢åŠ©æ‰‹

ä¸»è¦å€Ÿé‰´ï¼š
- å‰åç«¯æ¶æ„æ¨¡å¼
- æ•°å­—äººæ§åˆ¶å™¨å°è£…
- å¯†é’¥ç®¡ç†æ–¹æ¡ˆ
- RAG çŸ¥è¯†åº“å®ç°
- çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

---

## é™„å½•ï¼šé¢å¤–ä¾èµ–

```json
{
  "dependencies": {
    "openai": "^4.x",
    "pdf-parse": "^1.1.x",
    "mammoth": "^1.6.x",
    "multer": "^1.4.x",
    "uuid": "^9.0.x",
    "idb-keyval": "^6.x",
    "react-window": "^1.x",
    "use-debounce": "^9.x",
    "react-lazy-load-image-component": "^1.x"
  },
  "devDependencies": {
    "vitest": "^1.x",
    "@testing-library/react": "^14.x",
    "@testing-library/jest-dom": "^6.x",
    "jsdom": "^23.x"
  }
}
```

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.0 | æœ€åæ›´æ–°: 2025-12-31*
